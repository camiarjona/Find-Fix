<div class="modal-overlay" (click)="cerrar.emit()"></div>

<div class="modal-content">

  <div class="modal-header">
    <div class="modal-icon">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
      </svg>
    </div>
    <h2>Mi Perfil</h2>
  </div>

  <ul class="detalle-lista">

    <li>
      <strong>Nombre:</strong>
      <div class="editable-container">
        @if (editingField() === 'nombre') {
          <div class="edit-mode">
            <input type="text" [(ngModel)]="tempValue" class="input-inline" [disabled]="isLoading()">
            <button class="btn-icon save" (click)="saveEdit('nombre')" title="Guardar">✅</button>
            <button class="btn-icon cancel" (click)="cancelEdit()" title="Cancelar">❌</button>
          </div>
        } @else {
          <div class="view-mode">
            <span>{{ usuario.nombre }}</span>
            <button class="btn-icon edit" (click)="startEdit('nombre', usuario.nombre)">✏️</button>
          </div>
        }
      </div>
    </li>

    <li>
      <strong>Apellido:</strong>
      <div class="editable-container">
        @if (editingField() === 'apellido') {
          <div class="edit-mode">
            <input type="text" [(ngModel)]="tempValue" class="input-inline">
            <button class="btn-icon save" (click)="saveEdit('apellido')">✅</button>
            <button class="btn-icon cancel" (click)="cancelEdit()">❌</button>
          </div>
        } @else {
          <div class="view-mode">
            <span>{{ usuario.apellido }}</span>
            <button class="btn-icon edit" (click)="startEdit('apellido', usuario.apellido)">✏️</button>
          </div>
        }
      </div>
    </li>

    <li>
      <strong>Email:</strong>
      <div class="view-mode">
        <span style="color: #9ca3af;">{{ usuario.email }}</span>
        </div>
    </li>

    <li>
      <strong>Teléfono:</strong>
      <div class="editable-container">
        @if (editingField() === 'telefono') {
          <div class="edit-mode">
            <input type="text" [(ngModel)]="tempValue" class="input-inline">
            <button class="btn-icon save" (click)="saveEdit('telefono')">✅</button>
            <button class="btn-icon cancel" (click)="cancelEdit()">❌</button>
          </div>
        } @else {
          <div class="view-mode">
            <span>{{ usuario.telefono || 'Sin asignar' }}</span>
            <button class="btn-icon edit" (click)="startEdit('telefono', usuario.telefono)">✏️</button>
          </div>
        }
      </div>
    </li>

    <li>
      <strong>Ciudad:</strong>
      <div class="editable-container">
        @if (editingField() === 'ciudad') {
          <div class="edit-mode">
            <select [(ngModel)]="tempValue" class="input-inline">
              <option value="" disabled>Selecciona tu ciudad</option>

              @for (city of availableCities(); track city) {
                <option [value]="city">{{ city }}</option>
              }
            </select>
            <button class="btn-icon save" (click)="saveEdit('ciudad')">✅</button>
            <button class="btn-icon cancel" (click)="cancelEdit()">❌</button>
          </div>
        } @else {
          <div class="view-mode">
            <span>{{ usuario.ciudad || 'Sin asignar' }}</span>
            <button class="btn-icon edit" (click)="startEdit('ciudad', usuario.ciudad)">✏️</button>
          </div>
        }
      </div>
    </li>

    <li>
      <strong>Roles:</strong>
      <div class="roles-container">
        @for (rol of usuario.roles; track rol) {
          <span class="status aceptado">{{ rol }}</span>
        }
      </div>
    </li>

  </ul>

  <div class="modal-actions">
    <button class="btn btn-primary" (click)="cerrar.emit()">Cerrar</button>
  </div>

</div>
