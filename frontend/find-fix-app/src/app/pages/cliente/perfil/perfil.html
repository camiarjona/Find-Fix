<div class="profile-page-container">

  <div class="page-header">
    <h1>Configuraci√≥n de Perfil</h1>
    <p>Gestiona tu informaci√≥n personal y la seguridad de tu cuenta</p>
  </div>

  @if (isLoading()) {
  <div class="loading-state">Cargando perfil...</div>
  } @else {

  <div class="profile-grid">

    <section class="card personal-info-card">
      <div class="card-header">
        <div class="header-icon">üë§</div>
        <h2>Informaci√≥n Personal</h2>
      </div>

      <div class="card-body">
        <div class="user-banner">
          <div class="avatar-circle">
            {{ usuario()?.nombre?.charAt(0) }}{{ usuario()?.apellido?.charAt(0) }}
          </div>
          <div class="user-names">
            <h3>{{ usuario()?.nombre }} {{ usuario()?.apellido }}</h3>
            <span class="role-badge">{{ usuario()?.roles?.[0] }}</span>
          </div>
        </div>

        <ul class="data-list">
          <li class="data-item">
            <span class="label">Nombre</span>
            <div class="value-container">
              @if (editingField() === 'nombre') {
              <div class="edit-mode">
                <input type="text" [(ngModel)]="tempValue" class="input-inline">
                <button class="action-btn save" (click)="saveEdit('nombre')"><svg xmlns="http://www.w3.org/2000/svg"
                    width="24" height="24" fill="#000000" viewBox="0 0 24 24">
                    <path
                      d="M9 15.59 4.71 11.3 3.3 12.71l5 5c.2.2.45.29.71.29s.51-.1.71-.29l11-11-1.41-1.41L9.02 15.59Z">
                    </path>
                  </svg></button>
                <button class="action-btn cancel" (click)="cancelEdit()"><svg xmlns="http://www.w3.org/2000/svg"
                    width="24" height="24" fill="#000000" viewBox="0 0 24 24">
                    <path
                      d="m7.76 14.83-2.83 2.83 1.41 1.41 2.83-2.83 2.12-2.12.71-.71.71.71 1.41 1.42 3.54 3.53 1.41-1.41-3.53-3.54-1.42-1.41-.71-.71 5.66-5.66-1.41-1.41L12 10.59 6.34 4.93 4.93 6.34 10.59 12l-.71.71z">
                    </path>
                  </svg></button>
              </div>
              } @else {
              <span class="value">{{ usuario()?.nombre }}</span>
              <button class="edit-pencil" (click)="startEdit('nombre', usuario()?.nombre)"><svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#000000" viewBox="0 0 24 24">
                  <path
                    d="m19.41,3c-.78-.78-2.05-.78-2.83,0L4.29,15.29c-.13.13-.22.29-.26.46l-1,4c-.08.34.01.7.26.95.19.19.45.29.71.29.08,0,.16,0,.24-.03l4-1c.18-.04.34-.13.46-.26l12.29-12.29c.78-.78.78-2.05,0-2.83l-1.59-1.59Zm-11.93,15.1l-2.11.53.53-2.11L15,7.41l1.59,1.59-9.1,9.1Zm10.51-10.51l-1.59-1.59,1.59-1.59,1.59,1.58-1.59,1.59Z">
                  </path>
                </svg></button>
              }
            </div>
          </li>

          <li class="data-item">
            <span class="label">Apellido</span>
            <div class="value-container">
              @if (editingField() === 'apellido') {
              <div class="edit-mode">
                <input type="text" [(ngModel)]="tempValue" class="input-inline">
                <button class="action-btn save" (click)="saveEdit('apellido')"><svg xmlns="http://www.w3.org/2000/svg"
                    width="24" height="24" fill="#000000" viewBox="0 0 24 24">
                    <path
                      d="M9 15.59 4.71 11.3 3.3 12.71l5 5c.2.2.45.29.71.29s.51-.1.71-.29l11-11-1.41-1.41L9.02 15.59Z">
                    </path>
                  </svg></button>
                <button class="action-btn cancel" (click)="cancelEdit()"><svg xmlns="http://www.w3.org/2000/svg"
                    width="24" height="24" fill="#000000" viewBox="0 0 24 24">
                    <path
                      d="m7.76 14.83-2.83 2.83 1.41 1.41 2.83-2.83 2.12-2.12.71-.71.71.71 1.41 1.42 3.54 3.53 1.41-1.41-3.53-3.54-1.42-1.41-.71-.71 5.66-5.66-1.41-1.41L12 10.59 6.34 4.93 4.93 6.34 10.59 12l-.71.71z">
                    </path>
                  </svg></button>
              </div>
              } @else {
              <span class="value">{{ usuario()?.apellido }}</span>
              <button class="edit-pencil" (click)="startEdit('apellido', usuario()?.apellido)"><svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#000000" viewBox="0 0 24 24">
                  <path
                    d="m19.41,3c-.78-.78-2.05-.78-2.83,0L4.29,15.29c-.13.13-.22.29-.26.46l-1,4c-.08.34.01.7.26.95.19.19.45.29.71.29.08,0,.16,0,.24-.03l4-1c.18-.04.34-.13.46-.26l12.29-12.29c.78-.78.78-2.05,0-2.83l-1.59-1.59Zm-11.93,15.1l-2.11.53.53-2.11L15,7.41l1.59,1.59-9.1,9.1Zm10.51-10.51l-1.59-1.59,1.59-1.59,1.59,1.58-1.59,1.59Z">
                  </path>
                </svg></button>
              }
            </div>
          </li>

          <li class="data-item">
            <span class="label">Email</span>
            <div class="value-container">
              <span class="value locked">{{ usuario()?.email }}</span>
              <span class="lock-icon" title="No editable">üîí</span>
            </div>
          </li>

          <li class="data-item">
            <span class="label">Tel√©fono</span>
            <div class="value-container">
              @if (editingField() === 'telefono') {
              <div class="edit-mode">
                <input type="text" [(ngModel)]="tempValue" class="input-inline">
                <button class="action-btn save" (click)="saveEdit('telefono')"><svg xmlns="http://www.w3.org/2000/svg"
                    width="24" height="24" fill="#000000" viewBox="0 0 24 24">
                    <path
                      d="M9 15.59 4.71 11.3 3.3 12.71l5 5c.2.2.45.29.71.29s.51-.1.71-.29l11-11-1.41-1.41L9.02 15.59Z">
                    </path>
                  </svg></button>
                <button class="action-btn cancel" (click)="cancelEdit()"><svg xmlns="http://www.w3.org/2000/svg"
                    width="24" height="24" fill="#000000" viewBox="0 0 24 24">
                    <path
                      d="m7.76 14.83-2.83 2.83 1.41 1.41 2.83-2.83 2.12-2.12.71-.71.71.71 1.41 1.42 3.54 3.53 1.41-1.41-3.53-3.54-1.42-1.41-.71-.71 5.66-5.66-1.41-1.41L12 10.59 6.34 4.93 4.93 6.34 10.59 12l-.71.71z">
                    </path>
                  </svg></button>
              </div>
              } @else {
              <span class="value">{{ usuario()?.telefono || 'No especificado' }}</span>
              <button class="edit-pencil" (click)="startEdit('telefono', usuario()?.telefono)"><svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#000000" viewBox="0 0 24 24">
                  <path
                    d="m19.41,3c-.78-.78-2.05-.78-2.83,0L4.29,15.29c-.13.13-.22.29-.26.46l-1,4c-.08.34.01.7.26.95.19.19.45.29.71.29.08,0,.16,0,.24-.03l4-1c.18-.04.34-.13.46-.26l12.29-12.29c.78-.78.78-2.05,0-2.83l-1.59-1.59Zm-11.93,15.1l-2.11.53.53-2.11L15,7.41l1.59,1.59-9.1,9.1Zm10.51-10.51l-1.59-1.59,1.59-1.59,1.59,1.58-1.59,1.59Z">
                  </path>
                </svg></button>
              }
            </div>
          </li>

          <li class="data-item">
            <span class="label">Ciudad</span>
            <div class="value-container">
              @if (editingField() === 'ciudad') {
              <div class="edit-mode">
                <select [(ngModel)]="tempValue" class="input-inline">
                  @for (city of availableCities(); track city) {
                  <option [value]="city">{{ city }}</option>
                  }
                </select>
                <button class="action-btn save" (click)="saveEdit('ciudad')"><svg xmlns="http://www.w3.org/2000/svg"
                    width="24" height="24" fill="#000000" viewBox="0 0 24 24">
                    <path
                      d="M9 15.59 4.71 11.3 3.3 12.71l5 5c.2.2.45.29.71.29s.51-.1.71-.29l11-11-1.41-1.41L9.02 15.59Z">
                    </path>
                  </svg></button>
                <button class="action-btn cancel" (click)="cancelEdit()"><svg xmlns="http://www.w3.org/2000/svg"
                    width="24" height="24" fill="#000000" viewBox="0 0 24 24">
                    <path
                      d="m7.76 14.83-2.83 2.83 1.41 1.41 2.83-2.83 2.12-2.12.71-.71.71.71 1.41 1.42 3.54 3.53 1.41-1.41-3.53-3.54-1.42-1.41-.71-.71 5.66-5.66-1.41-1.41L12 10.59 6.34 4.93 4.93 6.34 10.59 12l-.71.71z">
                    </path>
                  </svg></button>
              </div>
              } @else {
              <span class="value">{{ usuario()?.ciudad || 'No especificada' }}</span>
              <button class="edit-pencil" (click)="startEdit('ciudad', usuario()?.ciudad)"><svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#000000" viewBox="0 0 24 24">
                  <path
                    d="m19.41,3c-.78-.78-2.05-.78-2.83,0L4.29,15.29c-.13.13-.22.29-.26.46l-1,4c-.08.34.01.7.26.95.19.19.45.29.71.29.08,0,.16,0,.24-.03l4-1c.18-.04.34-.13.46-.26l12.29-12.29c.78-.78.78-2.05,0-2.83l-1.59-1.59Zm-11.93,15.1l-2.11.53.53-2.11L15,7.41l1.59,1.59-9.1,9.1Zm10.51-10.51l-1.59-1.59,1.59-1.59,1.59,1.58-1.59,1.59Z">
                  </path>
                </svg></button>
              }
            </div>
          </li>
        </ul>
      </div>
    </section>

    <section class="card security-card">
      <div class="card-header">
        <div class="header-icon locked-icon">üõ°Ô∏è</div>
        <h2>Seguridad</h2>
      </div>

      <div class="card-body">
        <form (ngSubmit)="changePassword()" class="security-form">
          <div class="form-group">
            <label>Contrase√±a Actual</label>
            <input type="password" [(ngModel)]="passwordData.passwordActual" name="currPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              required>
          </div>

          <div class="form-group">
            <label>Nueva Contrase√±a</label>
            <input type="password" [(ngModel)]="passwordData.passwordNuevo" name="newPass"
              placeholder="M√≠nimo 6 caracteres" required>
          </div>

          <div class="form-group">
            <label>Confirmar Nueva Contrase√±a</label>
            <input type="password" [(ngModel)]="passwordData.confirmacion" name="confPass"
              placeholder="Repite la nueva contrase√±a" required>
          </div>

          <button type="submit" class="btn-full-width" [disabled]="isPasswordLoading()">
            {{ isPasswordLoading() ? 'Actualizando...' : 'Cambiar Contrase√±a' }}
          </button>
        </form>
      </div>
    </section>

  </div>
  }
</div>
